<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<dom-module id="bartend-pump">
  <template strip-whitespace>
    <style>
    :host {
      display: block;
      margin: 3px;
      padding: 10px;
    }
    .ingredient {
      list-style-type: none;      
    }
    .content {
      margin: 10px;
    }
    </style>
    <h1>Pump [[pump.id]]</h1>
    <div class="content">
      <paper-dropdown-menu id="liquid" on-iron-select="update" label="[[pump.liquid]]">
        <paper-listbox class="dropdown-content">
          <template is="dom-repeat" items="[[liquids]]">
            <paper-item>[[item]]</paper-item>
          </template>
        </paper-listbox>
      </paper-dropdown-menu>
    </div>
    <div>
      <paper-button raised on-click="on">On</paper-button>
      <paper-button raised on-click="off">Off</paper-button>
    </div>
  </template>

  <script>
    Polymer({
      is: 'bartend-pump',

      properties : {
        pump: Object,
      },

      attached: function() {
        var self = this;
        var r = new XMLHttpRequest();
        r.open("GET", bartend.apiUrl + '?fields=liquids', true);
        r.onreadystatechange = function() {
          if (r.readyState === XMLHttpRequest.DONE) {
            if (r.status === 200) {
                self.liquids = JSON.parse(r.responseText).liquids;
            }
          }
        }; 
        r.send();        
      },

      update: function() {
        var r = new XMLHttpRequest();
        r.open("PUT", bartend.apiUrl + 'pump=' + this.pump.id, true);
        r.send('{"liquid":"' + this.$.liquid.value + '"}');
      },

      on : function() {
        this._enable(true);
      },

      off : function() {
        this._enable(false);
      },

      _enable: function(on) {
        var r = new XMLHttpRequest();
        var cmd = on ? "on" : "off";
        r.open("POST", bartend.apiUrl + "pump=" + this.pump.id + "/" + cmd);
        r.send();      
      }
    });
  </script>
</dom-module>

